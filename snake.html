<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LN5WKNMNR1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LN5WKNMNR1');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Snake (with Swipe Anywhere)</title>
  <style>
    :root { --bg:#0f1218; --fg:#eaf2ff; --muted:#a7b1c2; --accent:#7cc36b; }
    * { box-sizing: border-box; }

    /* Lock viewport: no scroll, no rubber-band */
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    body{
      position: fixed;    /* prevents iOS bounce */
      inset: 0;
      overflow: hidden;
      overscroll-behavior: none;
      display: grid;
      place-items: center;
    }

    .wrap { width: 100%; max-width: 520px; padding: 20px; }
    h1 { margin: 0 0 10px; font-size: 22px; text-align: center; }
    .bar { display:flex; justify-content:space-between; align-items:center; margin:8px 0 14px; font-size:14px; color:var(--muted); }

    canvas {
      display:block; width:100%; height:auto;
      background:#141925; border:2px solid #222b3a; border-radius:12px;
      touch-action: none; /* capture gestures on canvas */
    }

    .hint { margin-top:10px; font-size:13px; color:var(--muted); text-align:center; }
    .btns { display:flex; gap:8px; justify-content:center; margin-top:10px; }
    button {
      background:#1c2332; color:var(--fg); border:1px solid #2a3447;
      padding:12px 14px; border-radius:10px; cursor:pointer; font-size:14px;
      touch-action: manipulation; /* allow taps */
    }
    button:active { filter:brightness(0.95); }
    button:hover  { filter:brightness(1.08); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üêç Snake</h1>
    <div class="bar">
      <div>Score: <span id="score">0</span></div>
      <div>Best: <span id="best">0</span></div>
    </div>

    <canvas id="game" width="420" height="420" aria-label="Snake game" role="img"></canvas>

    <div class="btns">
      <button id="restart" type="button" aria-label="Restart">Restart (Space)</button>
      <button id="pause"   type="button" aria-label="Pause/Resume">Pause (P)</button>
    </div>

    <p class="hint">Keyboard: arrows/WASD ‚Ä¢ Mobile: <b>swipe anywhere</b> on the page.</p>
  </div>

  <script>
    // --- Config
    const CELL = 20;
    const COLS = 21, ROWS = 21;   // 420x420 canvas
    const SPEED = 120;            // ms / tick

    // --- DOM
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d', { alpha:false });
    const scoreEl = document.getElementById('score');
    const bestEl  = document.getElementById('best');
    const btnRestart = document.getElementById('restart');
    const btnPause   = document.getElementById('pause');

    // --- Game state
    let snake, dir, nextDir, food, score, best, paused, dead, loop;

    function randCell(){ return { x: Math.floor(Math.random()*COLS), y: Math.floor(Math.random()*ROWS) }; }

    function placeFood(){
      let f;
      do { f = randCell(); } while (snake.some(s => s.x===f.x && s.y===f.y));
      food = f;
    }

    function reset(){
      snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
      dir = {x:1,y:0};
      nextDir = dir;
      score = 0;
      paused = false;
      dead = false;
      scoreEl.textContent = score;
      placeFood();
      draw();
    }

    function tick(){
      if (paused || dead) return;
      dir = nextDir;

      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

      // Walls / self
      if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) { gameOver(); return; }
      if (snake.some(s => s.x === head.x && s.y === head.y)) { gameOver(); return; }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        scoreEl.textContent = score;
        best = Math.max(best || 0, score);
        localStorage.setItem('snake-best', best);
        bestEl.textContent = best;
        placeFood();
      } else {
        snake.pop();
      }

      draw();
    }

    function draw(){
      // bg
      ctx.fillStyle = '#0e1422';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // grid
      ctx.strokeStyle = '#192236';
      ctx.lineWidth = 1;
      for (let x = CELL; x < canvas.width; x += CELL) {
        ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
      }
      for (let y = CELL; y < canvas.height; y += CELL) {
        ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
      }

      // food
      ctx.fillStyle = '#e06d6d';
      ctx.fillRect(food.x*CELL+2, food.y*CELL+2, CELL-4, CELL-4);

      // snake
      ctx.fillStyle = '#7cc36b';
      snake.forEach(s => ctx.fillRect(s.x*CELL+2, s.y*CELL+2, CELL-4, CELL-4));

      if (paused) overlay('Paused');
      if (dead)   overlay('Game Over');
    }

    function overlay(text){
      ctx.fillStyle = 'rgba(0,0,0,0.5)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 32px system-ui,-apple-system,Segoe UI,Roboto,Arial';
      ctx.textAlign = 'center';
      ctx.fillText(text, canvas.width/2, canvas.height/2);
      ctx.font = '14px system-ui,-apple-system,Segoe UI,Roboto,Arial';
      ctx.fillText('Press Space or Pause to resume', canvas.width/2, canvas.height/2 + 26);
    }

    function gameOver(){ dead = true; draw(); }

    function setDir(nx, ny){
      if (dead || paused) return;                 // don't move while paused
      if (nx === -dir.x && ny === -dir.y) return; // no instant reverse
      nextDir = { x:nx, y:ny };
    }

    // --- Keyboard
    window.addEventListener('keydown', e => {
      const k = e.key.toLowerCase();
      if (k === 'arrowup'   || k === 'w') setDir(0,-1);
      else if (k === 'arrowdown' || k === 's') setDir(0, 1);
      else if (k === 'arrowleft' || k === 'a') setDir(-1,0);
      else if (k === 'arrowright'|| k === 'd') setDir(1, 0);
      else if (k === ' ') { reset(); }
      else if (k === 'p') { paused = !paused; draw(); }
    }, { passive:true });

    // --- Global swipe anywhere (with scroll lock)
    // We capture touches anywhere on the document and prevent scrolling,
    // EXCEPT on interactive controls (buttons/links/inputs).
    const isInteractive = (el) => {
      return el.closest && el.closest('button, a, input, textarea, select, label');
    };

    let touchId = null, startX = 0, startY = 0, moved = false;
    const SWIPE_MIN = 24;

    document.addEventListener('touchstart', (e) => {
      const t = e.changedTouches[0];
      // If started on an interactive element, let the browser handle it
      if (isInteractive(e.target)) return;
      touchId = t.identifier;
      startX = t.clientX; startY = t.clientY; moved = false;
      e.preventDefault(); // stop page scroll / rubber-band
    }, { passive:false });

    document.addEventListener('touchmove', (e) => {
      if (isInteractive(e.target)) return;
      // Only care about our tracked touch
      for (const t of e.changedTouches) {
        if (t.identifier === touchId) {
          moved = true;
          e.preventDefault(); // keep page from moving
          break;
        }
      }
    }, { passive:false });

    document.addEventListener('touchend', (e) => {
      if (isInteractive(e.target)) return;
      let ended = null;
      for (const t of e.changedTouches) {
        if (t.identifier === touchId) { ended = t; break; }
      }
      if (!ended) return;
      e.preventDefault();

      const dx = ended.clientX - startX;
      const dy = ended.clientY - startY;
      touchId = null;

      if (!moved) return;
      if (Math.abs(dx) < SWIPE_MIN && Math.abs(dy) < SWIPE_MIN) return;

      if (Math.abs(dx) > Math.abs(dy)) {
        setDir(dx > 0 ? 1 : -1, 0);
      } else {
        setDir(0, dy > 0 ? 1 : -1);
      }
    }, { passive:false });

    // --- Buttons (CLICK only)
    const handleRestart = (e) => { e.preventDefault(); reset(); }
    const handlePause   = (e) => { e.preventDefault(); paused = !paused; draw(); }

    btnRestart.addEventListener('click', handleRestart);
    btnPause.addEventListener('click', handlePause);

    // --- Start
    best = Number(localStorage.getItem('snake-best') || 0);
    bestEl.textContent = best;
    reset();
    loop = setInterval(tick, SPEED);
  </script>
</body>
</html>