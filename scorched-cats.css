:root{
  --bg:#0b1020; --bg2:#0e1430; --card:#121932; --ink:#e8ecff; --muted:#aab3d9;
  --line:#233055; --accent:#6ea8fe; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
  --pad:12px; --radius:16px;
}

*{box-sizing:border-box}
html,body{
  margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--ink);
  font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;height:100%;
  overscroll-behavior:none; overflow:hidden;
}

/* Letterboxed stage */
.stage-wrap{position:fixed; inset:0; display:flex; align-items:center; justify-content:center}
.stage{
  position:relative; border-radius:14px; border:1px solid var(--line);
  overflow:hidden; background:#0b1020;
}
canvas{display:block; touch-action:manipulation}

/* HUD */
.hud{position:absolute; inset:0; pointer-events:none}
.hud *{pointer-events:auto}

.topbar{
  position:absolute; left:10px; right:10px; top:10px;
  display:flex; gap:10px; align-items:center; justify-content:space-between;
  background:rgba(18,25,50,.85); backdrop-filter: blur(6px);
  border:1px solid var(--line); border-radius:999px; padding:6px 10px; z-index:35;
  font-size:14px;
}
.topbar .left,.topbar .mid,.topbar .right{display:flex; align-items:center; gap:10px}
.chip{padding:4px 10px; border:1px solid var(--line); border-radius:999px; background:#0f1633}
.chip-timer{font-weight:700}
.small{color:var(--muted);font-size:12px}

/* Wind meter */
.meter{position:relative; width:120px; height:8px; background:#1a2346; border-radius:99px; overflow:hidden}
.meter .left,.meter .right{position:absolute; top:0; height:100%}
.meter .left{right:50%; background:#6ea8fe}
.meter .right{left:50%; background:#ef4444}
.meter .mid{position:absolute; left:50%; top:-2px; bottom:-2px; width:2px; background:#27335f; transform:translateX(-1px); border-radius:99px}

/* Dock */
.dock{
  position:absolute; left:10px; right:10px; bottom:10px;
  display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center;
  background:rgba(18,25,50,.85); backdrop-filter: blur(6px);
  border:1px solid var(--line); border-radius:16px; padding:10px;
}
.btn{
  appearance:none;border:1px solid var(--line);background:var(--accent);color:#081225;
  font-weight:700;border-radius:12px;padding:10px 14px;cursor:pointer
}
.btn-small{padding:6px 12px}
.btn:disabled{opacity:.5;cursor:not-allowed}
.btn-alt{background:#a78bfa}
.btn-ghost{background:#141c3a;color:var(--ink)}

.weaponBadge{
  border:1px solid var(--line); background:#0f1633; color:var(--ink);
  padding:8px 12px; border-radius:999px; cursor:pointer; user-select:none;
  display:flex; align-items:center; gap:8px; min-width:150px
}
.weaponMenu{
  position:absolute; bottom:58px; left:10px;
  background:rgba(18,25,50,.95); border:1px solid var(--line); border-radius:12px; padding:6px;
  display:none; flex-direction:column; gap:6px; z-index:40; min-width:190px
}
.weaponMenu .opt{
  padding:8px 10px; border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:space-between;
  border:1px solid transparent; gap:10px
}
.weaponMenu .opt:hover{ background:#0f1633; border-color:#2a3560 }
.weaponMenu .opt.active{ background:#a78bfa; color:#081225; border-color:#a78bfa }
.ammoPips{font-size:12px;color:var(--muted)}
.fuseChip,.fuseChip *{cursor:pointer}
.fuseChip{border:1px solid var(--line); padding:2px 6px; border-radius:999px; font-size:12px; background:#141c3a}

.fireWrap{position:relative; display:flex; align-items:center; justify-content:center}
.fireBtn{ width:100%; min-height:44px }
.chargeBar{
  position:absolute; left:10px; right:10px; bottom:6px; height:3px;
  background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444);
  width:0%; border-radius:99px; transition:width .06s linear; pointer-events:none;
}

/* Zoom buttons */
.zoomRow{display:flex; gap:8px}
.zoomRow .btn{min-width:44px}

/* Menu */
.menuPanel{
  position:absolute; top:60px; left:50%; transform:translateX(-50%);
  width:min(92%,760px); background:rgba(10,14,30,.92); border:1px solid var(--line); border-radius:16px; padding:14px; display:none; z-index:50;
  max-height:calc(100vh - 90px); overflow:auto; -webkit-overflow-scrolling:touch;
}
.menuGrid{display:grid; grid-template-columns:1fr 1fr; gap:14px}
.menuRow{display:flex; align-items:center; justify-content:space-between; gap:10px}
.menuRow > * {font-size:14px}
.sel,.txt{
  appearance:none; background:#0f1633; color:#e8ecff; border:1px solid var(--line); border-radius:10px; padding:8px 10px;
}
.chk{accent-color:#6ea8fe; width:16px; height:16px; vertical-align:middle; margin-right:6px}
label{cursor:pointer}
.miniPreview{border:1px solid var(--line); border-radius:12px; overflow:hidden; background:#0b1020}
.menuActions{display:flex; gap:10px; justify-content:flex-end; margin-top:12px}
.mr8{margin-right:8px}

/* Winner */
.banner{
  position:absolute; inset:0; display:none; align-items:center; justify-content:center; z-index:60;
  background:rgba(0,0,0,.35); backdrop-filter:blur(4px)
}
.card{
  background:rgba(18,25,50,.95); border:1px solid var(--line); border-radius:16px; padding:18px; min-width:280px; text-align:center
}
.win-title{font-weight:800;font-size:18px;margin-bottom:6px}
.stats{color:var(--muted); font-size:13px; margin:8px 0 12px}

/* Nameplates */
.nameplate{position:absolute; transform:translate(-50%, -100%); background:rgba(18,25,50,.9); border:1px solid var(--line);
  padding:2px 8px; border-radius:999px; font-size:12px; pointer-events:none}

/* Rotate overlay */
.rotate{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background:linear-gradient(180deg,var(--bg),var(--bg2)); z-index:1000; text-align:center; padding:24px;
}
.rotate .box{
  background:rgba(18,25,50,.93); border:1px solid var(--line); border-radius:14px; padding:16px 18px; max-width:360px;
}
.rot-title{font-weight:700; margin-bottom:6px}

.kb-help{position:absolute; right:12px; bottom:86px; opacity:.85; display:none}

/* Joystick */
.joy{
  position:absolute; left:12px; bottom:92px; width:128px; height:128px; display:none; z-index:45;
  touch-action:none;
}
.joy-base{
  position:absolute; inset:0; border-radius:50%; background:rgba(18,25,50,.55); border:1px solid var(--line)
}
.joy-knob{
  position:absolute; left:50%; top:50%; width:56px; height:56px; transform:translate(-50%,-50%);
  border-radius:50%; background:rgba(110,168,254,.9); border:2px solid #223055
}

/* Responsive */
@media (orientation:portrait){ .rotate{display:flex} }
@media (max-width:700px){ .menuGrid{grid-template-columns:1fr} }
